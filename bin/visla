#!/usr/bin/env/python3
import argparse
from pathlib import Path
from visla import VGraph
import matplotlib.pyplot as plt


# set up command line argument parser
parser = argparse.ArgumentParser()
parser.add_argument('file',
                    metavar='file',
                    help='file in Matrix Market (.mtx) format'
                    )
parser.add_argument('--filetype',
                    choices=VGraph()._VGraph__impl_files,
                    metavar='extension',
                    help='force usage of filetype (if not detected automatically'
                    )
parser.add_argument('--bipartite',
                    action='store_true',
                    default=False,
                    help='visualize bipartite version of matrix (automatically applied to non-square matrices)'
                    )
parser.add_argument('--algorithm',
                    choices=['neato','fdp','sfdp'],
                    default='sfdp',
                    action='store',
                    help='algorithm used to lay out graph in 2D'
                    )
parser.add_argument('--save',
                    metavar='file',
                    action='store',
                    help='also save visualization to file (determined from extension)'
                    )
parser.add_argument('--linewidth',
                    action='store',
                    metavar='width',
                    help='linewidth in render, float'
                    )
args = parser.parse_args()
path = Path(args.file)
file_type = args.filetype
bipartite = args.bipartite
algorithm = args.algorithm
linewidth = args.linewidth
save = args.save

B = VGraph()  # object to hold graph
B.bipartite = bipartite
B.from_file(path,file_type=file_type)
B.layout(prog=algorithm)  # lay out graph nodes in 2D using sdfp algorithm

if (save is not None): # set up out own fig/ax to show and save figure
    fig, ax = plt.subplots(nrows=1,ncols=1)  # we own figure to control/save plot
    fig, ax = B.mm_vis(fig,ax,linewidth=linewidth)  # visualize graph
    plt.show()
    fig.savefig(save,transparent=True)
else:
    B.mm_vis(linewidth=linewidth)

